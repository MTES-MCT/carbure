{% extends "common/base_private.html" %}


{% block content  %}
<div class="main" style="overflow-x: auto;">
  <div class="panel">
    <h3>Attestation de Durabilité</h3>
    {% csrf_token %}

    <div id="tab_valid" class="tabcontent">
      <p>Ces lots ont été validés et acceptés par vos clients.</p>

      <div class="flex-container">
        <a id="btn_open_modal_columns_tab_valid" class="button modal-button" style="margin-left: 5px; margin-right: 0px; padding: var(--space-xs) var(--space-xs) 0 var(--space-xs)" >
          <img src="/static/images/icons/internal/funnel2.svg" height="24" width="24"  style="margin-bottom: 5px;" />
        </a>
        <a class="button modal-button" href="{% url 'producers-api-attestation-export-valid' %}" style="margin-left: 5px; padding: 7px 10px 0px 10px;">
          <img src="/static/images/icons/download2.png" height="24" width="24"  style="margin-bottom: 5px;"/>
        </a>
        <select id="pagelength" style="margin-top: auto;">
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
        <label for="input_search_datatable" style="margin: auto 5px auto auto;">Rechercher:</label>
        <input type="text" id="input_search_datatable" style="width: 200px; margin-top: auto;" />
      </div>


      <table class="display nowrap" id="datatable_valid">
        <!-- dynamically generated in js -->
        <thead></thead>
        <tfoot></tfoot>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal__backdrop" id="modal_columns_tab_valid">
  <div class="modal">
    <div class="flex-container">
      <table id="table_columns_tab_valid_filter">
        <!-- dynamically generated in js -->
      </table>
      <table id="table_columns_tab_valid_filter2">
        <!-- dynamically generated in js -->
      </table>
    </div>
    <div class="form__group button__group">
      <a class="button secondary close" id="btn_close_modal_columns_tab_valid">Fermer</a>
    </div>
  </div>
</div>

<div class="modal__backdrop" id="modal_show_lot">
  <div class="modal" style="max-width: none; margin: auto; max-height: 100%; overflow-y: auto;">
    <p id="err_msg_dom">
    </p>
    <div class="flex-container modal-edit">
      <div class="form__group" style="margin-top: var(--space-l);">
        <h3 style="text-align: center;">Informations</h3>
        <input type="hidden" id="lot_id" />
        <dl>
          <dt>Le producteur est enregistré sur carbure ?</dt>
          <dd>Oui <input type="radio" name="producer_is_in_carbure" value="yes"/> Non <input type="radio" name="producer_is_in_carbure" value="no"/></dd>

          <!-- Producer is in Carbure -->
          <dt id="carbure_producer_name_label">Producteur</dt>
          <dd><input type="text" id="carbure_producer_name" class="autocomplete_producers" /><span id="carbure_producer_name_error" style="color:tomato;"></span><input type="hidden" id="carbure_producer_id" /></dd>
          <dt id="carbure_production_site_name_label">Site de Production</dt>
          <dd><input type="text" id="carbure_production_site_name" class="autocomplete_production_sites" /><span id="carbure_production_site_name_error" style="color:tomato;"></span><input type="hidden" id="carbure_production_site_id" /></dd>

          <!-- Producer is NOT in Carbure -->
          <dt id="unknown_producer_name_label">Producteur</dt>
          <dd><input type="text" id="unknown_producer_name" /><span id="unknown_producer_name_error" style="color:tomato;"></span></dd>
          <dt id="unknown_production_site_name_label">Site de Production</dt>
          <dd><input type="text" id="unknown_production_site_name" /><span id="unknown_production_site_name_error" style="color:tomato;"></span></dd>
          <dt id="unknown_production_site_country_label">Pays de Production</dt>
          <dd><input type="text" id="unknown_production_site_country" class="autocomplete_countries"/><span id="unknown_production_site_country_error" style="color:tomato;"></span><input type="hidden" id="unknown_production_site_country_code" /></dd>
          <dt id="unknown_production_site_reference_label">Référence Système Fournisseur</dt>
          <dd><input type="text" id="unknown_production_site_reference" /><span id="unknown_production_site_reference_error" style="color:tomato;"></span></dd>
          <dt id="unknown_production_site_dbl_counting_label">Numéro d'enregistrement double-compte</dt>
          <dd><input type="text" id="unknown_production_site_dbl_counting" /><span id="unknown_production_site_dbl_counting_error" style="color:tomato;"></span></dd>
          <dt id="unknown_production_site_com_date_label">Date de mise en service</dt>
          <dd><input type="text" id="unknown_production_site_com_date" /><span id="unknown_production_site_com_date_error" style="color:tomato;"></span></dd>




          <dt>Volume à 20°C en Litres</dt>
          <dd><input type="text" id="volume" /><span id="volume_error" style="color:tomato;"></span></dd>
          <dt>Biocarburant</dt>
          <dd><input type="text" id="biocarburant" class="autocomplete_biocarburants" /><span id="biocarburant_error" style="color:tomato;"></span><input type="hidden" id="biocarburant_code" /></dd>
          <dt>Matiere Premiere</dt>
          <dd><input type="text" id="matiere_premiere" class="autocomplete_mps" /><span id="matiere_premiere_error" style="color:tomato;"></span><input type="hidden" id="matiere_premiere_code" /></dd>
          <dt>Pays d'origine</dt>
          <dd><input type="text" id="pays_origine" class="autocomplete_countries" /><span id="pays_origine_error" style="color:tomato;"></span><input type="hidden" id="pays_origine_code" /></dd>
        </dl>
      </div>
      <div class="form__group" style="margin-left: var(--space-l);">
        <h3 style="text-align: center;">Destination</h3>
        <dl>
        <dt><label for="dae">Numéro douanier</label></dt>
        <dd><input id="dae" type="text" /><span id="dae_error" style="color:tomato;"></span></dd>

        <dt>Le client est enregistré sur carbure ?</dt>
        <dd>Oui <input type="radio" name="client_is_in_carbure" value="yes"/> Non <input type="radio" name="client_is_in_carbure" value="no"/></dd>


        <!-- Client is in Carbure -->
        <dt id="carbure_client_label"><label for="carbure_client">Client</label></dt>
        <dd><input type="text" id="carbure_client" class="autocomplete_clients" /><span id="carbure_client_error" style="color:tomato;"></span><input type="hidden" id="carbure_client_id" /></dd>

        <dt id="carbure_delivery_site_label"><label for="carbure_delivery_site">Site de livraison</label></dt>
        <dd><input id="carbure_delivery_site" type="text" class="autocomplete_depots" /><span id="carbure_delivery_site_error" style="color:tomato;"></span><input type="hidden" id="carbure_delivery_site_id" /></dd>


        <!-- Client is not in Carbure -->
        <dt id="unknown_client_label"><label for="unknown_client">Client</label></dt>
        <dd><input type="text" id="unknown_client" /><span id="unknown_client_error" style="color:tomato;"></span></dd>

        <dt id="unknown_delivery_site_label"><label for="unknown_delivery_site">Site de livraison</label></dt>
        <dd><input id="unknown_delivery_site" type="text" /><span id="unknown_delivery_site_error" style="color:tomato;"></span></dd>
        <dt id="unknown_delivery_site_country_label"><label for="unknown_delivery_site_country">Pays de livraison</label></dt>
        <dd><input id="unknown_delivery_site_country" type="text" class="autocomplete_countries" /><span id="unknown_delivery_site_country_error" style="color:tomato;"></span><input type="hidden" id="unknown_delivery_site_country_code" /></dd>


        <dt><label for="delivery_date">Date de livraison</label></dt>
        <dd><input id="delivery_date" type="text" placeholder="AAAA-MM-JJ" /><span id="delivery_date_error" style="color:tomato;"></span></dd>
        <dt><label for="champ_libre">Champ Libre</label></dt>
        <dd><input id="champ_libre" type="text" /><span id="champ_libre_error" style="color:tomato;"></span></dd>
        </dl>
      </div>
      <div class="form__group" style="margin-left: var(--space-l);">
        <h3>Gaz à Effet de Serre</h3>
        <span style="margin-top: -2em; display: block; text-align: left;"><small>en gCO2eq/MJ</small></span>
        <table id="table_lot_ges">
          <thead>
            <th>Émissions</th>
            <th>Réductions</th>
          </thead>
          <tbody>
            <tr>
              <td>
                <label for="eec" title="Émissions résultant de l'extraction ou de la culture des matières premières">EEC* </label><input type="text" id="eec" class="ges_field ges_incr" />
              </td>
              <td>
                <label for="esca" title="Réductions d'émissions dues à l'accumulation du carbone dans les sols grâce à une meilleure gestion agricole">ESCA* </label><input type="text" id="esca" class="ges_field ges_decr" />
              </td>
            </tr>
            <tr>
              <td>
                <label title="Émissions annualisées résultant de modifications des stocks de carbone dues à des changements dans l'affectation des sols">EL* </label><input type="text" id="el" class="ges_field ges_incr" />
              </td>
              <td>
                <label title="Réductions d'émissions dues au piégeage et au stockage géologique du carbone">ECCS* </label><input type="text" id="eccs" class="ges_field ges_decr" />
              </td>
            </tr>
            <tr>
              <td>
                <label title="Émissions résultant de la transformation">EP* </label><input type="text" id="ep" class="ges_field ges_incr" />
              </td>
              <td>
                <label title="Réductions d'émissions dues au piégeage et à la substitution du carbone">ECCR* </label><input type="text" id="eccr" class="ges_field ges_decr" />
              </td>
            </tr>
            <tr>
              <td>
                <label title="Émissions résultant du transport et de la distribution">ETD* </label><input type="text" id="etd" class="ges_field ges_incr" />
              </td>
              <td>
                <label title="Réductions d'émissions dues à la production excédentaire d'électricité dans le cadre de la cogénération">EEE* </label><input type="text" id="eee" class="ges_field ges_decr" />
              </td>
            </tr>
            <tr>
              <td>
                <label title="Émissions résultant du carburant à l'usage">EU* </label><input type="text" id="eu" class="ges_field ges_incr" />
              </td>
              <td>
              </td>
            </tr>
          </tbody>
        </table>
        <table>
          <input type="hidden" id="ghg_reference" />
          <thead>
            <tr>
              <th>Total gCO2eq/MJ</th>
              <th id="reduction_title" title="">Réduction<small>*</small></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="ghg_total"></td>
              <td id="ghg_reduction"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="form__group" id="comments_section">
    </div>
    <div class="form__group button__group">
      <a class="button primary" id="btn_lot_save">Sauvegarder</a>
      <a class="button secondary close" id="btn_close_modal_edit_lot">Annuler</a>
    </div>
  </div>
</div>

{% endblock %}


{% block extra_js %}
<script type="text/javascript">
window.producers_api_lots_valid_v2 = "{% url 'api-v2-producers-get-valid' %}"
$(document).ready(function() {
  // show drafts tab
  tabcontent = document.getElementById("tab_valid")
  tabcontent.style.display = "block";
  init_datatables_generic("tab_valid")
})
</script>

{% endblock %}
