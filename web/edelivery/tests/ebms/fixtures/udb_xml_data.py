def ghg_details_fragment(ghg_details):
    eec_fragment = f"<EEC>{ghg_details['eec']}</EEC>" if "eec" in ghg_details else ""

    return f"""\
<GHG_DETAILS>
  <GHG_METHOD_TYPE>AV</GHG_METHOD_TYPE>
  <GHG_TOTAL_VALUE>22</GHG_TOTAL_VALUE>
  <GHG_MEASURING_UNIT_ACR>gCO2eq/MJ</GHG_MEASURING_UNIT_ACR>
  {eec_fragment}
  <EP>20</EP>
  <ETD>2</ETD>
  <EU>0</EU>
  <DDV_APPLIED_FOR_SOIL_N2O_EMISSIONS>false</DDV_APPLIED_FOR_SOIL_N2O_EMISSIONS>
  <FUEL_BONUS_IF_BIOMASS_FROM_RESTORED_DEGRADED_LAND>false</FUEL_BONUS_IF_BIOMASS_FROM_RESTORED_DEGRADED_LAND>
</GHG_DETAILS>"""

def transaction_data(
    biofuel=None,
    client_id="FR_SIREN_CD222222222",
    delivery_date="2025-01-30T00:00:00.000Z",
    feedstock=None,
    ghg_details=None,
    quantity=None,
    status="ACCEPTED",
    supplier_id="FR_SIREN_CD111111111",
    udb_transaction_id="TRN-0000000159437-1766484490",
):
    if biofuel is None:
        biofuel = {"code": "SFC0015", "name": "Biogas"}
    if feedstock is None:
        feedstock = {"code": "URWS023", "name": "Sugar beet"}
    if ghg_details is None:
        ghg_details = {"eec": 50, "el": 40, "ep": 30, "etd": 20, "eu": 10, "esca": 5, "eccs": 3, "eccr": 2}
    if quantity is None:
        quantity = {"unit": "MWh", "value": 2000}

    return f"""\
<EO_TRANSACTION>
  <SELLER_ECONOMIC_OPERATOR_NUMBER>{supplier_id}</SELLER_ECONOMIC_OPERATOR_NUMBER>
  <SELLER_CERTIFICATE_NUMBER>EU-ISCC-Cert-Test-FR004</SELLER_CERTIFICATE_NUMBER>
  <BUYER_ECONOMIC_OPERATOR_NUMBER>{client_id}</BUYER_ECONOMIC_OPERATOR_NUMBER>
  <LOADING_DATE>2025-12-26T00:00:00.000Z</LOADING_DATE>
  <PLACE_OF_LOADING_NAME>TestSite004</PLACE_OF_LOADING_NAME>
  <PLACE_OF_LOADING_POSTCODE>1004</PLACE_OF_LOADING_POSTCODE>
  <DELIVERY_DATE>{delivery_date}</DELIVERY_DATE>
  <REFERENCE_NUMBER>SOME_REFERENCE</REFERENCE_NUMBER>
  <TRADE_DATE>2025-12-22T00:00:00.000Z</TRADE_DATE>
  <MATERIAL_CODE>{biofuel["code"]}</MATERIAL_CODE>
  <STATUS>{status}</STATUS>
  <POS_ID>POS-0000000219349-1766484490</POS_ID>
  <TRANSACTION_ID>{udb_transaction_id}</TRANSACTION_ID>
  <NON_RECOGNISED_VS>false</NON_RECOGNISED_VS>
  <MATERIAL_NAME>{biofuel["name"]}</MATERIAL_NAME>
  <EO_TRANS_DETAIL_MATERIALS>
    <ORIGINAL_POS>POS-0000000219348-1766484297</ORIGINAL_POS>
    <PREVIOUS_POS>POS-0000000219347-1766484297</PREVIOUS_POS>
    <QUANTITY>{quantity["value"]}</QUANTITY>
    <MEASURE_UNIT>{quantity["unit"]}</MEASURE_UNIT>
    <CONSIGNMENT_MATERIAL_DATA>
      <NON_RECOGNISED_VS>false</NON_RECOGNISED_VS>
      <COUNTRY_OF_PRODUCTION>FR</COUNTRY_OF_PRODUCTION>
      <PRODUCTION_PLANT_START_DATE>2025-12-22T00:00:00.000Z</PRODUCTION_PLANT_START_DATE>
    </CONSIGNMENT_MATERIAL_DATA>
    <POINT_OF_ORIGIN_MATERIAL_DATA>
      <ORIGINAL_POS>POS-0000000202542-1759499603</ORIGINAL_POS>
      <MATERIAL_CODE>{feedstock["code"]}</MATERIAL_CODE>
      <MATERIAL_NAME>{feedstock["name"]}</MATERIAL_NAME>
      <BIOMASS_LAND_CRITERIA>false</BIOMASS_LAND_CRITERIA>
      <LOW_ILUC>false</LOW_ILUC>
      <COUNTRY_OF_ORIGIN>FR</COUNTRY_OF_ORIGIN>
    </POINT_OF_ORIGIN_MATERIAL_DATA>
    {ghg_details_fragment(ghg_details)}
  </EO_TRANS_DETAIL_MATERIALS>
  <POS_DATA>
    <POS_FLAG>true</POS_FLAG>
    <METHOD_TYPE>AV</METHOD_TYPE>
    <ETD>2</ETD>
    <COMMENTS>Anyway.</COMMENTS>
    <SELLER_TRANSPORT>
      <TRANSPORT_DATA>
        <MODE_OF_TRANSPORT_ROAD_DISTANCE_KM>120</MODE_OF_TRANSPORT_ROAD_DISTANCE_KM>
      </TRANSPORT_DATA>
    </SELLER_TRANSPORT>
  </POS_DATA>
</EO_TRANSACTION>"""
